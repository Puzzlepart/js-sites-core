var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){e.Provisioning_progressbar_id="js-sites-core-progress",e.Provisioning_progressbar_text_id="js-sites-core-progress-text",e.Provisioning_progressbar_markup='<div class="progress-bar" role="progressbar" aria-valuenow="{0}" aria-valuemin="0" aria-valuemax="100" style="width:{0}%">{0}%</div>',e.Provisioning_started="Starting at URL {0}",e.Provisioning_ended="Done in {0} seconds",e.Provisioning_timeout="Timeout for {0} seconds",e.WaitMessage_header="Applying template",e.WaitMessage_content="This might take a moment.",e.Code_execution_started="Code execution scope started",e.Code_execution_ended="Code execution scope ended",e.Lists_list_already_exists="A list with the specified title {0} already exists in this Web site at Url {1}",e.Lists_creating_list="Creating list with title {0} at Url {1}",e.Lists_creating_folder="Creating folder {0}",e.Lists_setting_default_value_for_folder="Setting default value '{0}' = '{1}' for folder '{2}'",e.Lists_setting_default_metadata="Setting default metadata for folder {0}",e.Lists_enabled_content_types="Enabled content types for list {0}",e.Lists_removing_content_type="Removing content type {0} from list {1}",e.Lists_adding_content_type="Adding content type {0} to list {1}",e.Lists_breaking_role_inheritance="Breaking Role Inheritance for list {0}",e.Lists_role_assignments_applied="Role assignements applied for list {0}",e.Lists_updating_list_view="Updating existing view {0} for list {1}",e.Lists_adding_list_view="Adding view {0} for list {1}",e.Lists_removing_existing_list_view="Removing existing view {0} for list {1}",e.Lists_adding_eventreceiver="Adding eventreceiver {0} to list {1}",e.Lists_adding_field_ref="Adding field {0} to list {1}",e.Lists_adding_field="Adding {0} field '{1}' to list '{2}'",e.Lists_adding_lookup_field="Adding {0} lookup field '{1}' to list '{2}'",e.Lists_adding_field_schema_xml="Adding field to list '{0}', using Schema XML",e.Lists_invalid_lookup_field="The lookup field '{0}' for list '{1}' is invalid",e.Lists_inserting_data_row="Adding data row {0} of {1} to list '{2}'",e.Lists_adding_ribbon_action="Adding ribbon action '{0}' to list '{1}'",e.Lists_adding_ribbon_action_dependency="Adding custom action for dependency for ribbon action '{0}' for list '{1}'",e.WebSettings_setting_welcomePage="Setting welcome page to {0}",e.WebSettings_setting_alternateCssUrl="Setting alternate css url to {0}",e.WebSettings_setting_masterUrl="Setting master url to {0}",e.WebSettings_setting_customMasterUrl="Setting custom master url to {0}",e.WebSettings_setting_saveSiteAsTemplateEnabled="Setting save site as template enabled to {0}",e.WebSettings_setting_quickLaunchEnabled="Setting quicklaunch enabled to {0}",e.WebSettings_setting_recycleBinEnabled="Setting recyclebin enabled to {0}",e.WebSettings_setting_treeViewEnabled="Setting treeview enabled to {0}",e.PropertyBagEntries_setting_property="Setting property '{0}' = '{1}' on web",e.PropertyBagEntries_setting_indexed_property="Setting property '{0}' as indexed",e.Pages_creating_page="Creating wiki page with Url {0}",e.Pages_creating_page_failed="Failed to create wiki page with Url {0}",e.Navigation_setting_shared="Setting useShared to {0}",e.Navigation_configuring_of_quicklaunch_done="Configuring of quicklaunch done",e.Navigation_configuring_of_quicklaunch_failed="Configuring of quicklaunch failed",e.Navigation_configuring_quicklaunch_navigation="Configuring quicklaunch navigation",e.Navigation_removing_existing_nodes="Removing existing navigation nodes",e.Navigation_adding_node="Adding navigation node with Url {0} and Title {1}",e.Navigation_adding_children_node="Adding navigation node with Url {0} and Title {1}, under parent {2}",e.CustomAction_already_exists="A custom action with Title '{0}' already exists",e.CustomAction_creating="Creating custom action with Title '{0}'",e.Files_retrieving_xml_for_webpart="Retrieving XML for webpart '{0}' from file",e.Files_replace_tokens_webpart="Replacing tokens of webpart '{0}' from definition",e.Files_removing_existing_webparts="Removing existing webparts for file with URL '{0}'",e.Files_adding_webpart="Adding web part '{0}' to zone '{1}' for file with URL '{2}'",e.Files_setting_properties="Setting properties for file with URL {0}",e.Files_setting_property="Setting property '{0}' = '{1}' for file with URL '{2}'",e.Files_retrieved_file_contents="Retrieved content for file with Url '{0}' from source file",e.Files_creating_file="Creating file with Url '{0}'",e.Files_skipping_form_file="File with Url {0} is a form file. Skipping creation.",e.Files_modifying_list_views="Modifying list views for list '{0}'",e.Files_modifying_list_view="Modifying list view with Url '{0}' for list '{1}'",e.Features_activating_feature="Activating feature with ID '{0}'",e.Features_deactivating_feature="Deactivating feature with ID '{0}'",e.ComposedLook_applying_theme="Applying theme. Color file '{0}' and font file '{1}'.",e.Providers_Queuing_Provider_JavaScript_function="Queuing provider-referenced JavaScript function",e.Providers_Loaded_Referenced_Script_Calling_Method="Loaded script-file and executing provider-referenced JavaScript function"}(t=e.Resources||(e.Resources={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this.array=[],this.loggingOptions=e}return e.prototype.loggerEnabled=function(){return console&&console.log},e.prototype.Information=function(e,t){if(this.loggingOptions){var n=new Date+" || Information || "+e+" || "+t;this.loggerEnabled&&this.loggingOptions.On&&console.log(n),this.array.push(n)}},e.prototype.Error=function(e,t){if(this.loggingOptions){var n=new Date+" || Error || "+e+" || "+t;this.loggerEnabled&&this.loggingOptions.On&&console.log(n),this.array.push(n)}},e.prototype.SaveToFile=function(){var e=jQuery.Deferred();if(!this.loggingOptions||!this.loggingOptions.LoggingFolder)return e.resolve(),e.promise();var t=SP.ClientContext.get_current(),n=t.get_site().get_rootWeb(),o=(new Date).getTime()+".txt",r=new SP.FileCreationInformation;r.set_url(o),r.set_content(new SP.Base64EncodedByteArray);for(var i=this.array.join("\n"),s=0;s<i.length;s++)r.get_content().append(i.charCodeAt(s));return t.load(n.getFolderByServerRelativeUrl(this.ReplaceSiteTokens(this.loggingOptions.LoggingFolder)).get_files().add(r)),t.executeQueryAsync(e.resolve,e.resolve),e.promise()},e.prototype.ReplaceSiteTokens=function(e){return e.replace(/{site}/g,_spPageContextInfo.webAbsoluteUrl).replace(/{sitecollection}/g,_spPageContextInfo.siteAbsoluteUrl)},e}();e.Logger=t}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){this.headers={accept:"application/json;odata=verbose"}}return e.prototype.getListData=function(e,t){return this.get(e+"/_api/web/lists/getByTitle('"+t+"')/Items")},e.prototype.get=function(e){return jQuery.ajax({url:e,type:"get",headers:this.headers})},e}();e.RestHelper=t}(t=e.Utilities||(e.Utilities={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e,t,n){this.index=0,this.parameter=t,this.scope=n,this.functions=this.deferredArray(e)}return e.prototype.init=function(e){var t=[];t.push(jQuery.Deferred()),t[0].resolve(),t[0].promise();for(var n=1;void 0!=this.functions[n-1];){var o=t.length-1;t.push(this.functions[n-1].execute(t[o])),n++}jQuery.when.apply(jQuery,t).done(e)},e.prototype.deferredArray=function(e){var t=this,o=[];return e.forEach(function(e){o.push(new n(e,t.parameter,t.scope))}),o},e}();e.Sequencer=t;var n=function(){function e(e,t,n){this.func=e,this.parameter=t,this.scope=n}return e.prototype.execute=function(e){var t=this;if(!e)return this.func.apply(this.scope,[this.parameter]);var n=jQuery.Deferred();return e.done(function(){t.func.apply(t.scope,[t.parameter]).done(n.resolve)}),n.promise()},e}()}(t=e.Utilities||(e.Utilities={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.getTokenValue=function(e){return e.replace("{{","").replace("}}","").split(":")[1]},e.prototype.getTokenKey=function(e){return e.replace("{{","").replace("}}","").split(":")[0]},e.prototype.ReplaceListTokens=function(e){var t=this,n=jQuery.Deferred(),o=SP.ClientContext.get_current(),r=o.get_web().get_lists();return o.load(r,"Include(Title,Id)"),o.executeQueryAsync(function(){var o=t.ReplaceListTokensFromListCollection(e,r.get_data());n.resolve(o)}),n.promise()},e.prototype.ReplaceListTokensFromListCollection=function(e,t){var n=this,o=e,r=e.match(/{{[listId:]+[\S]*}}/g);return r&&r.forEach(function(e){var r=n.getTokenValue(e.toString()),i=jQuery.grep(t,function(e){return e.get_title()==r})[0];i&&(o=o.replace(e.toString(),"{"+i.get_id().toString()+"}"))}),o},e.prototype.ReplaceUrlTokens=function(e){return e.replace(/{resources}/g,_spPageContextInfo.siteAbsoluteUrl+"/resources").replace(/{webpartgallery}/g,_spPageContextInfo.siteAbsoluteUrl+"/_catalogs/wp").replace(/{site}/g,_spPageContextInfo.webServerRelativeUrl).replace(/{sitecollection}/g,_spPageContextInfo.siteAbsoluteUrl)},e.prototype.ReplaceWebPartTokens=function(e,t){return e.replace(/{webpart:title}/g,t.Title)},e}();e.TokenParser=t}(t=e.Utilities||(e.Utilities={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(e,t,n,o,r){this.name=e,this.index=t,this.objects=n,this.parameters=o,this.handler=r}return t.prototype.execute=function(t){var n=this,o=new this.handler;if(!t)return o.ProvisionObjects(this.objects,this.parameters);var r=jQuery.Deferred();return t.done(function(){return e.UpdateProgress(n.index,n.name),o.ProvisionObjects(n.objects,n.parameters).done(r.resolve)}),r.promise()},t}();t.ProvisioningStep=n}(t=e.Model||(e.Model={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){function t(){var e=jQuery.Deferred();return ExecuteOrDelayUntilScriptLoaded(function(){var t=SP.ClientContext.get_current(),n=t.get_site(),o=n.get_features();t.load(o),t.executeQueryAsync(function(){var t=jQuery.grep(o.get_data(),function(e){return"f6924d36-2fa8-4f0b-b16d-06b7250180fa"==e.get_definitionId()});t.length>0?(SP.SOD.registerSod("sp.publishing.js",_spPageContextInfo.siteAbsoluteUrl+"/_layouts/15/sp.publishing.js"),EnsureScriptFunc("sp.publishing.js",null,function(){e.resolve(!0)})):e.resolve(!1)},function(){e.resolve(!1)})},"SP.js"),e.promise()}e.IsPublishingEnabled=t}(t=e.Helpers||(e.Helpers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(t){var n;!function(t){var n;!function(t){var n=function(){function t(t){this.name=t,this.tokenParser=new e.Sites.Core.Utilities.TokenParser}return t.prototype.ProvisionObjects=function(e,t){},t}();t.ObjectHandlerBase=n}(n=t.Model||(t.Model={}))}(n=t.Core||(t.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n;!function(e){function t(e){return e.replace("{sitecollection}",_spPageContextInfo.siteAbsoluteUrl).replace("{themegallery}",_spPageContextInfo.siteServerRelativeUrl+"/_catalogs/theme/15")}e.GetUrlWithoutTokens=t}(n||(n={}));var o=function(t){function o(){t.call(this,"ComposedLook")}return __extends(o,t),o.prototype.ProvisionObjects=function(t){var o=this;e.Log.Information(this.name,e.Resources.Code_execution_started);var r=jQuery.Deferred(),i=SP.ClientContext.get_current(),s=i.get_web(),a=t.ColorPaletteUrl?n.GetUrlWithoutTokens(t.ColorPaletteUrl):"",l=t.FontSchemeUrl?n.GetUrlWithoutTokens(t.FontSchemeUrl):"",c=t.BackgroundImageUrl?n.GetUrlWithoutTokens(t.BackgroundImageUrl):null;return e.Log.Information(this.name,String.format(e.Resources.ComposedLook_applying_theme,a,l)),s.applyTheme(a,l,c,!0),s.update(),i.executeQueryAsync(function(){e.Log.Information(o.name,e.Resources.Code_execution_ended),r.resolve()},function(t,n){e.Log.Information(o.name,e.Resources.Code_execution_ended),e.Log.Information(o.name,n.get_message()),r.resolve(t,n)}),r.promise()},o}(e.Model.ObjectHandlerBase);t.ComposedLook=o}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this,"CustomActions")}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=this,o=jQuery.Deferred();e.Log.Information(this.name,e.Resources.Code_execution_started);var r=SP.ClientContext.get_current(),i=r.get_web().get_userCustomActions();return r.load(i),r.executeQueryAsync(function(){t.forEach(function(t){var o=jQuery.grep(i.get_data(),function(e){return e.get_title()==t.Title}).length>0;if(o)e.Log.Information(n.name,String.format(e.Resources.CustomAction_already_exists,t.Title));else{e.Log.Information(n.name,String.format(e.Resources.CustomAction_creating,t.Title));var r=i.add();t.Description&&r.set_description(t.Description),t.CommandUIExtension&&r.set_commandUIExtension(t.CommandUIExtension),t.Group&&r.set_group(t.Group),t.Title&&r.set_title(t.Title),t.Url&&r.set_url(t.Url),t.ScriptBlock&&r.set_scriptBlock(t.ScriptBlock),t.ScriptSrc&&r.set_scriptSrc(t.ScriptSrc),t.Location&&r.set_location(t.Location),t.ImageUrl&&r.set_imageUrl(t.ImageUrl),t.Name&&r.set_name(t.Name),t.RegistrationId&&r.set_registrationId(t.RegistrationId),t.RegistrationType&&r.set_registrationType(t.RegistrationType),t.Rights&&r.set_rights(t.Rights),t.Sequence&&r.set_sequence(t.Sequence),r.update()}}),r.executeQueryAsync(function(){e.Log.Information(n.name,e.Resources.Code_execution_ended),o.resolve()},function(t,r){e.Log.Information(n.name,e.Resources.Code_execution_ended),e.Log.Error(n.name,r.get_message()),o.resolve(t,r)})},function(t,r){e.Log.Information(n.name,e.Resources.Code_execution_ended),e.Log.Error(n.name,r.get_message()),o.resolve(t,r)}),o.promise()},n}(e.Model.ObjectHandlerBase);t.CustomActions=n}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this,"Features")}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=this;e.Log.Information(this.name,e.Resources.Code_execution_started);var o=jQuery.Deferred(),r=SP.ClientContext.get_current(),i=r.get_web(),s=i.get_features();return t.forEach(function(t){1==t.Deactivate?(e.Log.Information(n.name,String.format(e.Resources.Features_deactivating_feature,t.ID)),s.remove(new SP.Guid(t.ID),!0)):(e.Log.Information(n.name,String.format(e.Resources.Features_activating_feature,t.ID)),s.add(new SP.Guid(t.ID),!0,SP.FeatureDefinitionScope.none))}),i.update(),r.load(s),r.executeQueryAsync(function(){e.Log.Information(n.name,e.Resources.Code_execution_ended),o.resolve()},function(t,r){e.Log.Information(n.name,e.Resources.Code_execution_ended),e.Log.Error(n.name,r.get_message()),o.resolve(t,r)}),o.promise()},n}(e.Model.ObjectHandlerBase);t.Features=n}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this,"Files")}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=this;e.Log.Information(this.name,e.Resources.Code_execution_started);var o=jQuery.Deferred(),r=SP.ClientContext.get_current(),i=r.get_web(),s=[],a=[];return t.forEach(function(t,o){var r=n.GetFilenameFromFilePath(t.Dest),l=i.getFolderByServerRelativeUrl(_spPageContextInfo.webServerRelativeUrl+"/"+n.GetFolderFromFilePath(t.Dest));a.push(jQuery.get(n.tokenParser.ReplaceUrlTokens(t.Src),function(o){var i={};jQuery.extend(i,t,{Filename:r,Folder:l,Contents:o}),s.push(i),e.Log.Information(n.name,String.format(e.Resources.Files_retrieved_file_contents,i.Dest))}))}),jQuery.when.apply(jQuery,a).done(function(){s.forEach(function(t,o){if(-1!=t.Filename.indexOf("Form.aspx"))return void e.Log.Information(n.name,String.format(e.Resources.Files_skipping_form_file,t.Dest));e.Log.Information(n.name,String.format(e.Resources.Files_creating_file,t.Dest));var i=new SP.FileCreationInformation;i.set_overwrite(void 0!=t.Overwrite?t.Overwrite:!1),i.set_url(t.Filename),i.set_content(new SP.Base64EncodedByteArray);for(var s=0;s<t.Contents.length;s++)i.get_content().append(t.Contents.charCodeAt(s));r.load(t.Folder.get_files().add(i))}),r.executeQueryAsync(function(){var r=[];t.forEach(function(e){e.Properties&&Object.keys(e.Properties).length>0&&r.push(n.ApplyFileProperties(e.Dest,e.Properties)),e.WebParts&&e.WebParts.length>0&&r.push(n.AddWebPartsToWebPartPage(e.Dest,e.Src,e.WebParts,e.RemoveExistingWebParts))}),jQuery.when.apply(jQuery,r).done(function(){n.ModifyHiddenViews(t).then(function(){e.Log.Information(n.name,e.Resources.Code_execution_ended),o.resolve()})})},function(t,r){e.Log.Information(n.name,e.Resources.Code_execution_ended),e.Log.Error(n.name,r.get_message()),o.resolve(t,r)})}),o.promise()},n.prototype.RemoveWebPartsFromFileIfSpecified=function(e,t,n){var o=jQuery.Deferred();if(!n)return o.resolve(),o.promise();var r=t.get_webParts();return e.load(r),e.executeQueryAsync(function(){r.get_data().forEach(function(e){e.deleteWebPart()}),e.load(r),e.executeQueryAsync(o.resolve,o.resolve)},o.resolve),o.promise()},n.prototype.GetWebPartXml=function(e){var t=this,n=jQuery.Deferred(),o=[];return e.forEach(function(n,r){n.Contents.FileUrl&&o.push(function(){var o=jQuery.Deferred(),i=t.tokenParser.ReplaceUrlTokens(n.Contents.FileUrl);return jQuery.get(i,function(t){e[r].Contents.Xml=t,o.resolve()}).fail(function(e,t){o.resolve(e,t)}),o.promise()}())}),jQuery.when.apply(jQuery,o).done(function(){n.resolve(e)}),n.promise()},n.prototype.AddWebPartsToWebPartPage=function(t,n,o,r){var i=this,s=jQuery.Deferred(),a=SP.ClientContext.get_current(),l=a.get_web(),c=(this.LastItemInArray(n.split("/")),_spPageContextInfo.webServerRelativeUrl+"/"+t),u=l.getFileByServerRelativeUrl(c);return a.load(u),a.executeQueryAsync(function(){var n=u.getLimitedWebPartManager(SP.WebParts.PersonalizationScope.shared);i.RemoveWebPartsFromFileIfSpecified(a,n,r).then(function(){i.GetWebPartXml(o).then(function(o){o.forEach(function(o){if(o.Contents.Xml){e.Log.Information("Files Web Parts",String.format(e.Resources.Files_replace_tokens_webpart,o.Title));var r=i.tokenParser.ReplaceUrlTokens(o.Contents.Xml);r=i.tokenParser.ReplaceWebPartTokens(r,o),e.Log.Information("Files Web Parts",String.format(e.Resources.Files_adding_webpart,o.Title,o.Zone,t));var s=n.importWebPart(r),a=s.get_webPart();n.addWebPart(a,o.Zone,o.Order)}}),a.executeQueryAsync(s.resolve,function(t,n){e.Log.Error("Files Web Parts",n.get_message()),s.resolve(t,n)})})})},function(t,n){e.Log.Error("Files Web Parts",n.get_message()),s.resolve(t,n)}),s.promise()},n.prototype.ApplyFileProperties=function(t,n){var o=jQuery.Deferred(),r=SP.ClientContext.get_current(),i=r.get_web(),s=_spPageContextInfo.webServerRelativeUrl+"/"+t,a=i.getFileByServerRelativeUrl(s),l=a.get_listItemAllFields();e.Log.Information("Files Properties",String.format(e.Resources.Files_setting_properties,t));for(var c in n)e.Log.Information("Files Properties",String.format(e.Resources.Files_setting_property,c,n[c],t)),l.set_item(c,n[c]);return l.update(),r.executeQueryAsync(o.resolve,function(t,n){e.Log.Error("Files Properties",n.get_message()),o.resolve(t,n)}),o.promise()},n.prototype.GetViewFromCollectionByUrl=function(e,t){for(var n=_spPageContextInfo.webServerRelativeUrl+"/"+t,o=e.getEnumerator();o.moveNext();){var r=o.get_current();if(r.get_serverRelativeUrl().toString().toLowerCase()===n.toLowerCase())return r}return null},n.prototype.ModifyHiddenViews=function(t){var n=this,o=jQuery.Deferred(),r=SP.ClientContext.get_current(),i=r.get_web(),s={},a=[],l=[];return t.forEach(function(e){e.Views&&e.Views.forEach(function(t){s[t.List]=s[t.List]||[],s[t.List].push(jQuery.extend(t,{Url:e.Dest}))})}),Object.keys(s).forEach(function(e,t){a.push(i.get_lists().getByTitle(e)),l.push(i.get_lists().getByTitle(e).get_views()),r.load(a[t]),r.load(l[t])}),r.executeQueryAsync(function(){Object.keys(s).forEach(function(t,o){e.Log.Information("Hidden Views",String.format(e.Resources.Files_modifying_list_views,t));var i=s[t],c=a[o],u=l[o];i.forEach(function(o){var r=n.GetViewFromCollectionByUrl(u,o.Url);if(null!=r){if(e.Log.Information("Hidden Views",String.format(e.Resources.Files_modifying_list_view,o.Url,t)),o.Paged&&r.set_paged(o.Paged),o.Query&&r.set_viewQuery(o.Query),o.RowLimit&&r.set_rowLimit(o.RowLimit),o.ViewFields&&o.ViewFields.length>0){var i=r.get_viewFields();i.removeAll(),o.ViewFields.forEach(function(e){i.add(e)})}r.update()}}),r.load(u),c.update()}),r.executeQueryAsync(o.resolve,function(t,n){e.Log.Error("Hidden Views",n.get_message()),o.resolve(t,n)})},function(t,n){e.Log.Error("Hidden Views",n.get_message()),o.resolve(t,n)}),o.promise()},n.prototype.GetFolderFromFilePath=function(e){var t=e.split("/");return t.splice(0,t.length-1).join("/")},n.prototype.GetFilenameFromFilePath=function(e){var t=e.split("/");return t[t.length-1]},n.prototype.LastItemInArray=function(e){return e[e.length-1]},n}(e.Model.ObjectHandlerBase);t.Files=n}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this,"Lists"),this.ribbonActionTemplate='<CommandUIExtension><CommandUIDefinitions><CommandUIDefinition Location="{0}.Groups._children"><Group Id="{0}.{1}" Sequence="33" Description="" Title="{1}" Template="Ribbon.Templates.Flexible2"><Controls Id="{0}.{1}.Controls"><Button Id="{0}.{1}.{2}" Command="{2}ButtonCommand" LabelText="{3}" Image16by16="{4}" Image32by32="{5}" Description="{6}" Sequence="{7}" TemplateAlias="o2" /></Controls></Group></CommandUIDefinition><CommandUIDefinition Location="{0}.Scaling._children"><MaxSize Id="{0}.{1}.MaxSize" Sequence="15" GroupId="{0}.{1}" Size="LargeLarge"/></CommandUIDefinition></CommandUIDefinitions><CommandUIHandlers><CommandUIHandler Command="{2}ButtonCommand" CommandAction="javascript:if(window[\'{0}.{1}.{2}.Loaded\']==true)%7B{0}.{1}.{2}();%7D;SP.SOD.registerSod(\'{0}.{1}.{2}.js\', \'{8}\');EnsureScriptFunc(\'{0}.{1}.{2}.js\', null, function()%7B{0}.{1}.{2}();window[\'{0}.{1}.{2}.Loaded\']=true;%7D);" /></CommandUIHandlers></CommandUIExtension>'}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=this;e.Log.Information(this.name,e.Resources.Code_execution_started);var o=jQuery.Deferred(),r=SP.ClientContext.get_current(),i=r.get_web().get_lists(),s=[];return r.load(i),r.executeQueryAsync(function(){t.forEach(function(t,o){var a=jQuery.grep(i.get_data(),function(e){return e.get_title()==t.Title})[0];if(a)e.Log.Information(n.name,String.format(e.Resources.Lists_list_already_exists,t.Title,t.Url)),t.Description&&a.set_description(t.Description),void 0!=t.EnableVersioning&&a.set_enableVersioning(t.EnableVersioning),void 0!=t.EnableMinorVersions&&a.set_enableMinorVersions(t.EnableMinorVersions),void 0!=t.EnableModeration&&a.set_enableModeration(t.EnableModeration),void 0!=t.EnableFolderCreation&&a.set_enableFolderCreation(t.EnableFolderCreation),void 0!=t.EnableAttachments&&a.set_enableAttachments(t.EnableAttachments),void 0!=t.NoCrawl&&a.set_noCrawl(t.NoCrawl),t.DefaultDisplayFormUrl&&a.set_defaultDisplayFormUrl(t.DefaultDisplayFormUrl),t.DefaultEditFormUrl&&a.set_defaultEditFormUrl(t.DefaultEditFormUrl),t.DefaultNewFormUrl&&a.set_defaultNewFormUrl(t.DefaultNewFormUrl),t.DraftVersionVisibility&&a.set_draftVersionVisibility(SP.DraftVisibilityType[t.DraftVersionVisibility]),t.ImageUrl&&a.set_imageUrl(t.ImageUrl),void 0!=t.Hidden&&a.set_hidden(t.Hidden),void 0!=t.ForceCheckout&&a.set_forceCheckout(t.ForceCheckout),a.update(),s.push(a),r.load(s[o]);else{e.Log.Information(n.name,String.format(e.Resources.Lists_creating_list,t.Title,t.Url));var l=new SP.ListCreationInformation;t.Description&&l.set_description(t.Description),void 0!=t.OnQuickLaunch&&l.set_quickLaunchOption(t.OnQuickLaunch?SP.QuickLaunchOptions.on:SP.QuickLaunchOptions.off),t.TemplateType&&l.set_templateType(t.TemplateType),t.Title&&l.set_title(t.Title),t.Url&&l.set_url(t.Url);var c=i.add(l);void 0!=t.EnableVersioning&&c.set_enableVersioning(t.EnableVersioning),void 0!=t.EnableMinorVersions&&c.set_enableMinorVersions(t.EnableMinorVersions),void 0!=t.EnableModeration&&c.set_enableModeration(t.EnableModeration),void 0!=t.EnableFolderCreation&&c.set_enableFolderCreation(t.EnableFolderCreation),void 0!=t.EnableAttachments&&c.set_enableAttachments(t.EnableAttachments),void 0!=t.NoCrawl&&c.set_noCrawl(t.NoCrawl),t.DefaultDisplayFormUrl&&c.set_defaultDisplayFormUrl(t.DefaultDisplayFormUrl),t.DefaultEditFormUrl&&c.set_defaultEditFormUrl(t.DefaultEditFormUrl),t.DefaultNewFormUrl&&c.set_defaultNewFormUrl(t.DefaultNewFormUrl),t.DraftVersionVisibility&&c.set_draftVersionVisibility(SP.DraftVisibilityType[t.DraftVersionVisibility.toLocaleLowerCase()]),t.ImageUrl&&c.set_imageUrl(t.ImageUrl),void 0!=t.Hidden&&c.set_hidden(t.Hidden),void 0!=t.ForceCheckout&&c.set_forceCheckout(t.ForceCheckout),s.push(c),r.load(s[o])}}),r.executeQueryAsync(function(){new e.Utilities.Sequencer([n.ApplyContentTypeBindings,n.ApplyListInstanceFieldRefs,n.ApplyFields,n.ApplyLookupFields,n.ApplyListSecurity,n.CreateViews,n.InsertDataRows,n.CreateFolders,n.AddRibbonActions],{ClientContext:r,ListInstances:s,Objects:t},n).init(function(){e.Log.Information(n.name,e.Resources.Code_execution_ended),o.resolve()})},function(t,r){e.Log.Information(n.name,e.Resources.Code_execution_ended),e.Log.Error(n.name,r.get_message()),o.resolve(t,r)})},function(t,r){e.Log.Information(n.name,e.Resources.Code_execution_ended),e.Log.Error(n.name,r.get_message()),o.resolve(t,r)}),o.promise()},n.prototype.AddRibbonActions=function(t){var n=this,o=jQuery.Deferred();return t.ListInstances.forEach(function(o,r){var i=t.Objects[r];i.RibbonActions&&i.RibbonActions.forEach(function(t){e.Log.Information("Lists Ribbon Actions",String.format(e.Resources.Lists_adding_ribbon_action,t.Name,o.get_title()));var r=o.get_userCustomActions().add();r.set_name(t.Control+"."+t.Name),r.set_title(t.Control+"."+t.Name),r.set_location(t.Location),r.set_sequence(5);var i=(t.LoadScript+"/"+t.Control+"."+t.Group+"."+t.Name+".js").replace("~sitecollection",_spPageContextInfo.siteAbsoluteUrl);r.set_commandUIExtension(decodeURIComponent(String.format(n.ribbonActionTemplate,t.Control,t.Group,t.Name,t.LabelText,t.Image16by16,t.Image32by32,t.Description,t.Sequence,i))),r.update()})}),t.ClientContext.executeQueryAsync(o.resolve,function(t,n){e.Log.Error("Lists Ribbon Actions",n.get_message()),o.resolve(t,n)}),o.promise()},n.prototype.EnsureLocationBasedMetadataDefaultsReceiver=function(t,n){var o=n.get_eventReceivers();e.Log.Information("Lists Event Receivers",String.format(e.Resources.Lists_adding_eventreceiver,"LocationBasedMetadataDefaultsReceiver ItemAdded",n.get_title()));var r=new SP.EventReceiverDefinitionCreationInformation;r.set_receiverName("LocationBasedMetadataDefaultsReceiver ItemAdded"),r.set_synchronization(1),r.set_sequenceNumber(1e3),r.set_receiverAssembly("Microsoft.Office.DocumentManagement, Version=15.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c"),r.set_receiverClass("Microsoft.Office.DocumentManagement.LocationBasedMetadataDefaultsReceiver"),r.set_eventType(SP.EventReceiverType.itemAdded),o.add(r),n.update()},n.prototype.CreateFolders=function(t){var n=this,o=jQuery.Deferred();return t.ListInstances.forEach(function(o,r){var i=t.Objects[r];if(i.Folders){var s=_spPageContextInfo.webServerRelativeUrl+"/"+i.Url,a=o.get_rootFolder(),l="<MetadataDefaults>",c=!1;if(i.Folders.forEach(function(t){var n=s+"/"+t.Name;if(e.Log.Information("Lists Folders",String.format(e.Resources.Lists_creating_folder,n)),a.get_folders().add(n),t.DefaultValues){e.Log.Information("Lists Folders",String.format(e.Resources.Lists_setting_default_metadata,n));var o=Object.keys(t.DefaultValues).length;o>0&&(l+="<a href='"+n+"'>",Object.keys(t.DefaultValues).forEach(function(o){e.Log.Information("Lists Folders",String.format(e.Resources.Lists_setting_default_value_for_folder,o,t.DefaultValues[o],n)),l+='<DefaultValue FieldName="'+o+'">'+t.DefaultValues[o]+"</DefaultValue>"}),l+="</a>"),c=!0}}),l+="</MetadataDefaults>",c){var u=new SP.FileCreationInformation;u.set_url(s+"/Forms/client_LocationBasedDefaults.html"),u.set_content(new SP.Base64EncodedByteArray),u.set_overwrite(!0);for(var d=0;d<l.length;d++)u.get_content().append(l.charCodeAt(d));a.get_files().add(u),n.EnsureLocationBasedMetadataDefaultsReceiver(t.ClientContext,o)}}}),t.ClientContext.executeQueryAsync(o.resolve,function(t,n){e.Log.Error("Lists Folders",n.get_message()),o.resolve(t,n)}),o.promise()},n.prototype.ApplyContentTypeBindings=function(t){var n=jQuery.Deferred(),o=t.ClientContext.get_site().get_rootWeb().get_contentTypes(),r=[];return t.ListInstances.forEach(function(n,o){r.push(n.get_contentTypes()),t.ClientContext.load(r[o],"Include(Name,Id)"),t.Objects[o].ContentTypeBindings&&(e.Log.Information("Lists Content Types",String.format(e.Resources.Lists_enabled_content_types,n.get_title())),n.set_contentTypesEnabled(!0),n.update())}),t.ClientContext.load(o),t.ClientContext.executeQueryAsync(function(){t.ListInstances.forEach(function(n,i){var s=t.Objects[i];if(s.ContentTypeBindings){var a=r[i],l=new Array;if(s.RemoveExistingContentTypes&&s.ContentTypeBindings.length>0&&a.get_data().forEach(function(e){l.push(e)}),s.ContentTypeBindings.forEach(function(t){e.Log.Information("Lists Content Types",String.format(e.Resources.Lists_adding_content_type,t.ContentTypeId,n.get_title())),a.addExistingContentType(o.getById(t.ContentTypeId))}),s.RemoveExistingContentTypes&&s.ContentTypeBindings.length>0)for(var c=0;c<l.length;c++){var u=l[c];e.Log.Information("Lists Content Types",String.format(e.Resources.Lists_removing_content_type,u.get_id().get_stringValue(),n.get_title())),u.deleteObject()}n.update()}}),t.ClientContext.executeQueryAsync(n.resolve,function(t,o){e.Log.Error("Lists Content Types",o.get_message()),n.resolve(t,o)})},function(t,o){e.Log.Error("Lists Content Types",o.get_message()),n.resolve(t,o)}),n.promise()},n.prototype.ApplyListInstanceFieldRefs=function(t){var n=jQuery.Deferred(),o=t.ClientContext.get_site().get_rootWeb().get_fields();return t.ListInstances.forEach(function(n,r){var i=t.Objects[r];i.FieldRefs&&(i.FieldRefs.forEach(function(t){e.Log.Information("Lists Field Refs",String.format(e.Resources.Lists_adding_field_ref,t.Name,n.get_title()));var r=o.getByInternalNameOrTitle(t.Name);n.get_fields().add(r)}),n.update())}),t.ClientContext.executeQueryAsync(n.resolve,function(t,o){e.Log.Error("Lists Field Refs",o.get_message()),n.resolve(t,o)}),n.promise()},n.prototype.ApplyFields=function(t){var n=this,o=jQuery.Deferred();return t.ListInstances.forEach(function(o,r){var i=t.Objects[r];i.Fields&&(i.Fields.forEach(function(r){var i=n.GetFieldXml(r,t.ListInstances,o),s=n.GetFieldXmlAttr(i,"Type"),a=n.GetFieldXmlAttr(i,"ID");"Lookup"!=s&&"LookupMulti"!=s&&(e.Log.Information("Lists Fields",String.format(e.Resources.Lists_adding_field,s,a,o.get_title())),o.get_fields().addFieldAsXml(i,!0,SP.AddFieldOptions.addToAllContentTypes));
}),o.update())}),t.ClientContext.executeQueryAsync(o.resolve,function(t,n){e.Log.Error("Lists Fields",n.get_message()),o.resolve(t,n)}),o.promise()},n.prototype.ApplyLookupFields=function(t){var n=this,o=jQuery.Deferred();return t.ListInstances.forEach(function(o,r){var i=t.Objects[r];i.Fields&&(i.Fields.forEach(function(r){var i=n.GetFieldXml(r,t.ListInstances,o);if(!i)return void e.Log.Information("Lists Lookup Fields",String.format(e.Resources.Lists_invalid_lookup_field,a,o.get_title()));var s=n.GetFieldXmlAttr(i,"Type"),a=n.GetFieldXmlAttr(i,"ID");("Lookup"==s||"LookupMulti"==s)&&(e.Log.Information("Lists Lookup Fields",String.format(e.Resources.Lists_adding_field,s,a,o.get_title())),o.get_fields().addFieldAsXml(i,!0,SP.AddFieldOptions.addToAllContentTypes))}),o.update())}),t.ClientContext.executeQueryAsync(o.resolve,function(t,n){e.Log.Error("Lists Fields",n.get_message()),o.resolve(t,n)}),o.promise()},n.prototype.GetFieldXmlAttr=function(e,t){return $(jQuery.parseXML(e)).find("Field").attr(t)},n.prototype.GetFieldXml=function(e,t,n){var o="";if(e.SchemaXml)o=this.tokenParser.ReplaceListTokensFromListCollection(e.SchemaXml,t);else{var r=[];for(var i in e){var s=e[i];if("List"==i){var a=jQuery.grep(t,function(e){return e.get_title()===s});if(!(a.length>0))return null;s="{"+a[0].get_id().toString()+"}"}"Formula"!=i&&r.push(i+'="'+s+'"')}o="<Field "+r.join(" ")+">","Calculated"==e.Type&&(o+="<Formula>"+e.Formula+"</Formula>"),o+="</Field>"}return o},n.prototype.ApplyListSecurity=function(t){var n=jQuery.Deferred();t.ListInstances.forEach(function(n,o){var r=t.Objects[o];r.Security&&r.Security.BreakRoleInheritance&&(e.Log.Information("Lists Security",String.format(e.Resources.Lists_breaking_role_inheritance,n.get_title())),n.breakRoleInheritance(r.Security.CopyRoleAssignments,r.Security.ClearSubscopes),n.update(),t.ClientContext.load(n.get_roleAssignments()))});var o=t.ClientContext.get_web(),r=o.get_allProperties(),i=o.get_siteGroups(),s=o.get_roleDefinitions();return t.ClientContext.load(r),t.ClientContext.load(s),t.ClientContext.executeQueryAsync(function(){t.ListInstances.forEach(function(n,o){var a=t.Objects[o];a.Security&&(a.Security.RoleAssignments.forEach(function(e){var o=null;o="number"==typeof e.RoleDefinition?s.getById(e.RoleDefinition):s.getByName(e.RoleDefinition);var a=SP.RoleDefinitionBindingCollection.newObject(t.ClientContext);a.add(o);var l=null;if(e.Principal.match(/\{[A-Za-z]*\}+/g)){var c=e.Principal.substring(1,e.Principal.length-1),u=r.get_fieldValues()["vti_"+c];l=i.getById(u)}else l=i.getByName(l);n.get_roleAssignments().add(l,a)}),n.update(),e.Log.Information("Lists Security",String.format(e.Resources.Lists_role_assignments_applied,n.get_title())))}),t.ClientContext.executeQueryAsync(n.resolve,function(t,o){e.Log.Error("Lists Security","Error: "+o.get_message()),n.resolve(t,o)})},function(t,o){e.Log.Error("Lists Security","Error: "+o.get_message()),n.resolve(t,o)}),n.promise()},n.prototype.CreateViews=function(t){e.Log.Information("Lists Views",e.Resources.Code_execution_started);var n=jQuery.Deferred(),o=[];return t.ListInstances.forEach(function(e,n){o.push(e.get_views()),t.ClientContext.load(o[n])}),t.ClientContext.executeQueryAsync(function(){t.ListInstances.forEach(function(n,r){var i=t.Objects[r];i.Views&&(o.push(n.get_views()),t.ClientContext.load(o[r]),i.Views.forEach(function(s){var a=jQuery.grep(o[r].get_data(),function(t){return i.RemoveExistingViews&&i.Views.length>0?(e.Log.Information("Lists Views",String.format(e.Resources.Lists_removing_existing_list_view,s.Title,n.get_title())),t.deleteObject(),!1):t.get_title()==s.Title}).length>0;if(a){var l=o[r].getByTitle(s.Title);if(e.Log.Information("Lists Views",String.format(e.Resources.Lists_updating_list_view,s.Title,n.get_title())),s.Paged&&l.set_paged(s.Paged),s.Query&&l.set_viewQuery(s.Query),s.RowLimit&&l.set_rowLimit(s.RowLimit),s.ViewFields&&s.ViewFields.length>0){var c=l.get_viewFields();c.removeAll(),s.ViewFields.forEach(function(e){c.add(e)})}s.Scope&&l.set_scope(s.Scope),l.update()}else{e.Log.Information("Lists Views",String.format(e.Resources.Lists_adding_list_view,s.Title,n.get_title()));var u=new SP.ViewCreationInformation;s.Title&&u.set_title(s.Title),s.PersonalView&&u.set_personalView(s.PersonalView),s.Paged&&u.set_paged(s.Paged),s.Query&&u.set_query(s.Query),s.RowLimit&&u.set_rowLimit(s.RowLimit),s.SetAsDefaultView&&u.set_setAsDefaultView(s.SetAsDefaultView),s.ViewFields&&u.set_viewFields(s.ViewFields),s.ViewTypeKind&&u.set_viewTypeKind(SP.ViewType.html);var l=n.get_views().add(u);s.Scope&&(l.set_scope(s.Scope),l.update()),n.update()}t.ClientContext.load(n.get_views())}))}),t.ClientContext.executeQueryAsync(n.resolve,function(t,o){e.Log.Error("Lists Views",o.get_message()),n.resolve(t,o)})},function(t,o){e.Log.Error("Lists Views",o.get_message()),n.resolve(t,o)}),n.promise()},n.prototype.InsertDataRows=function(t){e.Log.Information("Lists Data Rows",e.Resources.Code_execution_started);var n=jQuery.Deferred();return t.ListInstances.forEach(function(n,o){var r=t.Objects[o];r.DataRows&&r.DataRows.forEach(function(o,i){e.Log.Information("Lists Data Rows",String.format(e.Resources.Lists_inserting_data_row,i+1,r.DataRows.length,n.get_title()));var s=n.addItem(new SP.ListItemCreationInformation);for(var a in o)s.set_item(a,o[a]);s.update(),t.ClientContext.load(s)})}),t.ClientContext.executeQueryAsync(function(){e.Log.Information("Lists Data Rows",e.Resources.Code_execution_ended),n.resolve()},function(t,o){e.Log.Error("Lists Data Rows",o.get_message()),n.resolve(t,o)}),n.promise()},n}(e.Model.ObjectHandlerBase);t.Lists=n}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this,"Navigation")}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=this,o=jQuery.Deferred(),r=SP.ClientContext.get_current(),i=r.get_web();return e.Log.Information(this.name,e.Resources.Code_execution_started),e.Helpers.IsPublishingEnabled().then(function(s){var a=i.get_navigation();if(1==t.UseShared){if(e.Log.Information(n.name,String.format(e.Resources.Navigation_setting_shared,t.UseShared)),s){var l=new SP.Publishing.Navigation.WebNavigationSettings(r,i),c=l.get_globalNavigation();c.set_source(3),l.update()}else a.set_useShared(t.UseShared);i.update()}r.executeQueryAsync(function(){return t.QuickLaunch&&0!=t.QuickLaunch.length?void n.ConfigureQuickLaunch(t.QuickLaunch,r,a).then(function(){e.Log.Information(n.name,e.Resources.Code_execution_ended),o.resolve()}):(e.Log.Information(n.name,e.Resources.Code_execution_ended),o.resolve(),o.promise())},function(t,r){e.Log.Information(n.name,e.Resources.Code_execution_ended),e.Log.Error(n.name,"Error: "+r.get_message()),o.resolve()})}),o.promise()},n.prototype.ConfigureQuickLaunch=function(t,n,o){var r=this;e.Log.Information("QuickLaunch",e.Resources.Navigation_configuring_quicklaunch_navigation);var i=jQuery.Deferred();if(0==t.length)i.resolve();else{var s=o.get_quickLaunch();n.load(s),n.executeQueryAsync(function(){e.Log.Information("QuickLaunch",e.Resources.Navigation_removing_existing_nodes);for(var a=[],l=s.get_count()-1;l>=0;){var c=s.itemAt(l);a.push(c),c.deleteObject(),l--}n.executeQueryAsync(function(){t.forEach(function(t){e.Log.Information("QuickLaunch",String.format(e.Resources.Navigation_adding_node,t.Url,t.Title));var n=r.GetNodeFromQuickLaunchByTitle(a,t.Title),o=new SP.NavigationNodeCreationInformation;o.set_title(t.Title),o.set_url(n?n.get_url():r.tokenParser.ReplaceUrlTokens(t.Url)),o.set_asLastNode(!0),s.add(o)}),n.executeQueryAsync(function(){jQuery.ajax({url:_spPageContextInfo.webAbsoluteUrl+"/_api/web/Navigation/QuickLaunch",type:"get",headers:{accept:"application/json;odata=verbose"}}).done(function(s){s=s.d.results,s.forEach(function(n){var i=o.getNodeById(n.Id),s=i.get_children(),l=jQuery.grep(t,function(e){return e.Title===n.Title})[0];l&&l.Children&&l.Children.forEach(function(t){var o=r.GetNodeFromQuickLaunchByTitle(a,t.Title),i=new SP.NavigationNodeCreationInformation;i.set_title(t.Title),i.set_url(o?o.get_url():r.tokenParser.ReplaceUrlTokens(t.Url)),i.set_asLastNode(!0),s.add(i),e.Log.Information("QuickLaunch",String.format(e.Resources.Navigation_adding_children_node,t.Url,t.Title,n.Title))})}),n.executeQueryAsync(function(){e.Log.Information("QuickLaunch",e.Resources.Navigation_configuring_of_quicklaunch_done),i.resolve()},function(t,n){e.Log.Information("QuickLaunch",e.Resources.Navigation_configuring_of_quicklaunch_failed),e.Log.Error("QuickLaunch",""+n.get_message()),i.resolve(t,n)})})},function(t,n){e.Log.Information("QuickLaunch",e.Resources.Navigation_configuring_of_quicklaunch_failed),e.Log.Error("QuickLaunch",""+n.get_message()),i.resolve(t,n)})})})}return i.promise()},n.prototype.GetNodeFromQuickLaunchByTitle=function(e,t){var n=jQuery.grep(e,function(e){return e.get_title()===t});return n[0]||null},n}(e.Model.ObjectHandlerBase);t.Navigation=n}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this,"Pages")}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=this;e.Log.Information(this.name,e.Resources.Code_execution_started);var o=jQuery.Deferred(),r=(SP.ClientContext.get_current(),[]);return t.forEach(function(e){n.AddWikiPageByUrl(e.Url)}),jQuery.when.apply(jQuery,r).done(function(){e.Log.Information(n.name,e.Resources.Code_execution_ended),o.resolve()}),o.promise()},n.prototype.AddWikiPageByUrl=function(t){var n=jQuery.Deferred();e.Log.Information("Pages",String.format(e.Resources.Pages_creating_page,t));var o=SP.ClientContext.get_current(),r=o.get_web(),i=_spPageContextInfo.webServerRelativeUrl+"/"+t,s=_spPageContextInfo.webServerRelativeUrl+"/"+this.GetFolderFromFilePath(t),a=r.getFolderByServerRelativeUrl(s);return o.load(a.get_files().addTemplateFile(i,SP.TemplateFileType.wikiPage)),o.executeQueryAsync(n.resolve,function(o,r){e.Log.Information("Pages",String.format(e.Resources.Pages_creating_page_failed,t)),e.Log.Error("Pages",""+r.get_message()),n.resolve(o,r)}),n.promise()},n.prototype.GetFolderFromFilePath=function(e){var t=e.split("/");return t.splice(0,t.length-1)},n}(e.Model.ObjectHandlerBase);t.Pages=n}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this,"PropertyBagEntries")}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=this;e.Log.Information(this.name,e.Resources.Code_execution_started);var o=jQuery.Deferred(),r=SP.ClientContext.get_current(),i=r.get_web(),s=i.get_allProperties(),a=[];return t.forEach(function(t){e.Log.Information(n.name,String.format(e.Resources.PropertyBagEntries_setting_property,t.Key,t.Value)),s.set_item(t.Key,t.Value),t.Indexed&&(e.Log.Information(n.name,String.format(e.Resources.PropertyBagEntries_setting_indexed_property,t.Key)),a.push(n.EncodePropertyKey(t.Key)))}),i.update(),r.load(s),r.executeQueryAsync(function(){a.length>0?(s.set_item("vti_indexedpropertykeys",a.join("|")),i.update(),r.executeQueryAsync(function(){e.Log.Information(n.name,e.Resources.Code_execution_ended),o.resolve()},function(){e.Log.Information(n.name,e.Resources.Code_execution_ended),o.resolve()})):(e.Log.Information(n.name,e.Resources.Code_execution_ended),o.resolve())},function(t,r){e.Log.Information(n.name,e.Resources.Code_execution_ended),o.resolve(t,r)}),o.promise()},n.prototype.EncodePropertyKey=function(e){for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n)),t.push(0);var o=window.btoa(String.fromCharCode.apply(null,t));return o},n}(e.Model.ObjectHandlerBase);t.PropertyBagEntries=n}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this,"Security")}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=this;e.Log.Information(this.name,e.Resources.Code_execution_started);var o=jQuery.Deferred(),r=SP.ClientContext.get_current(),i=r.get_web();t.BreakRoleInheritance&&(i.breakRoleInheritance(t.CopyRoleAssignments,t.ClearSubscopes),i.update());var s=r.get_site().get_rootWeb().get_allProperties(),a=r.get_site().get_rootWeb().get_siteGroups(),l=r.get_site().get_rootWeb().get_roleDefinitions();return r.load(s),r.load(a),r.load(l),r.executeQueryAsync(function(){t.RoleAssignments&&0!=t.RoleAssignments.length||(e.Log.Information(n.name,e.Resources.Code_execution_ended),o.resolve()),t.RoleAssignments.forEach(function(e){var t=null;t="number"==typeof e.RoleDefinition?l.getById(e.RoleDefinition):l.getByName(e.RoleDefinition);var o=SP.RoleDefinitionBindingCollection.newObject(r);o.add(t);var c=n.ParseGroupPrincipal(a,s,e.Principal);i.get_roleAssignments().add(c,o)}),i.update(),r.executeQueryAsync(function(){e.Log.Information(n.name,e.Resources.Code_execution_ended),o.resolve()},function(t,r){e.Log.Information(n.name,e.Resources.Code_execution_ended),e.Log.Error(n.name,r.get_message()),o.resolve(t,r)})},function(t,r){e.Log.Information(n.name,e.Resources.Code_execution_ended),e.Log.Error(n.name,r.get_message()),o.resolve(t,r)}),o.promise()},n.prototype.ParseGroupPrincipal=function(e,t,n){if(n.match(/\{[A-Za-z]*\}+/g)){var o=n.substring(1,n.length-1),r=t.get_fieldValues()["vti_"+o];return e.getById(r)}return e.getByName(n)},n}(e.Model.ObjectHandlerBase);t.Security=n}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this,"WebSettings")}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=this;e.Log.Information(this.name,e.Resources.Code_execution_started);var o=jQuery.Deferred(),r=SP.ClientContext.get_current(),i=r.get_web();return t.WelcomePage&&(e.Log.Information(this.name,String.format(e.Resources.WebSettings_setting_welcomePage,t.WelcomePage)),i.get_rootFolder().set_welcomePage(t.WelcomePage),i.get_rootFolder().update()),t.AlternateCssUrl&&(e.Log.Information(this.name,String.format(e.Resources.WebSettings_setting_alternateCssUrl,t.AlternateCssUrl)),i.set_alternateCssUrl(t.AlternateCssUrl)),t.MasterUrl&&(e.Log.Information(this.name,String.format(e.Resources.WebSettings_setting_masterUrl,t.MasterUrl)),i.set_masterUrl(t.MasterUrl)),t.CustomMasterUrl&&(e.Log.Information(this.name,String.format(e.Resources.WebSettings_setting_customMasterUrl,t.CustomMasterUrl)),i.set_customMasterUrl(t.CustomMasterUrl)),void 0!=t.SaveSiteAsTemplateEnabled&&(e.Log.Information(this.name,String.format(e.Resources.WebSettings_setting_saveSiteAsTemplateEnabled,t.SaveSiteAsTemplateEnabled)),i.set_saveSiteAsTemplateEnabled(t.SaveSiteAsTemplateEnabled)),void 0!=t.QuickLaunchEnabled&&(e.Log.Information(this.name,String.format(e.Resources.WebSettings_setting_quickLaunchEnabled,t.QuickLaunchEnabled)),i.set_saveSiteAsTemplateEnabled(t.QuickLaunchEnabled)),void 0!=t.RecycleBinEnabled&&(e.Log.Information(this.name,String.format(e.Resources.WebSettings_setting_recycleBinEnabled,t.RecycleBinEnabled)),i.set_recycleBinEnabled(t.RecycleBinEnabled)),void 0!=t.TreeViewEnabled&&(e.Log.Information(this.name,String.format(e.Resources.WebSettings_setting_treeViewEnabled,t.TreeViewEnabled)),i.set_treeViewEnabled(t.TreeViewEnabled)),i.update(),r.load(i),r.executeQueryAsync(function(){e.Log.Information(n.name,e.Resources.Code_execution_ended),o.resolve()},function(t,r){e.Log.Information(n.name,e.Resources.Code_execution_ended),o.resolve(t,r)}),o.promise()},n}(e.Model.ObjectHandlerBase);t.WebSettings=n}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(Pzl){var Sites;!function(Sites){var Core;!function(Core){var ObjectHandlers;!function(ObjectHandlers){var Providers=function(_super){function Providers(){_super.call(this,"Providers")}return __extends(Providers,_super),Providers.prototype.ProvisionObjects=function(e){var t=this;Core.Log.Information(this.name,Core.Resources.Code_execution_started);var n=jQuery.Deferred(),o=[];return e.forEach(function(e){if(e.Enabled&&"JavaScript"===e.HandlerType&&e.Configuration){var n=t.tokenParser.ReplaceUrlTokens(e.Configuration.FileRef),r=n.split("/").pop(),i=e.Configuration.Func,s=[];e.Configuration.FuncParams.forEach(function(e){s.push(t.tokenParser.ReplaceUrlTokens(e))}),Core.Log.Information(t.name,Core.Resources.Providers_Queuing_Provider_JavaScript_function),o.push(t.ExecuteFunc(r,n,i,s))}}),jQuery.when.apply(null,o).then(function(){n.resolve()}),n.promise()},Providers.prototype.ExecuteFunc=function(fileName,fileRef,funcName,funcParams){var _this=this;SP.SOD.registerSod(fileName,fileRef);var fDef=jQuery.Deferred();return EnsureScriptFunc(fileName,null,function(){Core.Log.Information(_this.name,Core.Resources.Providers_Loaded_Referenced_Script_Calling_Method),jQuery.when(eval(funcName).apply(_this,funcParams)).then(function(){fDef.resolve()})}),fDef.promise()},Providers}(Core.Model.ObjectHandlerBase);ObjectHandlers.Providers=Providers}(ObjectHandlers=Core.ObjectHandlers||(Core.ObjectHandlers={}))}(Core=Sites.Core||(Sites.Core={}))}(Sites=Pzl.Sites||(Pzl.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){function t(t){var n={width:600,height:130},o=e.Resources.WaitMessage_header,r=e.Resources.WaitMessage_content;t&&(t.Header&&(o=t.Header),t.Content&&(r=t.Content),t.ShowProgress===!0&&(r="",r+='<style type="text/css">.progress{overflow:hidden;height:20px;margin-bottom:20px;background-color:#f5f5f5;border-radius:4px;-webkit-box-shadow:inset 0 1px 2px rgba(0,0,0,.1);box-shadow:inset 0 1px 2px rgba(0,0,0,.1)}.progress-bar{float:left;width:0;height:100%;font-size:12px;line-height:20px;color:#fff;text-align:center;background-color:#337ab7;-webkit-box-shadow:inset 0 -1px 0 rgba(0,0,0,.15);box-shadow:inset 0 -1px 0 rgba(0,0,0,.15);-webkit-transition:width .6s ease;-o-transition:width .6s ease;transition:width .6s ease}</style>',r+='<div id="'+e.Resources.Provisioning_progressbar_id+'" class="progress">\n                                '+String.format(e.Resources.Provisioning_progressbar_markup,"0")+'\n                            </div>\n                            <div id="'+e.Resources.Provisioning_progressbar_text_id+'"></div>\n                            ',n.width=700,n.height=160)),l=SP.UI.ModalDialog.showWaitScreenWithNoClose(o,r,n.height,n.width)}function n(e){return Object.keys(e)}function o(t,n){var o=jQuery.Deferred();c=(new Date).getTime(),e.Log.Information("Provisioning",String.format(e.Resources.Code_execution_started,_spPageContextInfo.webServerRelativeUrl)),a=[],n.forEach(function(n,o){e.ObjectHandlers[n]&&a.push(new e.Model.ProvisioningStep(n,o,t[n],t.Parameters,e.ObjectHandlers[n]))});var r=[];r.push(jQuery.Deferred()),r[0].resolve(),r[0].promise();for(var i=1;void 0!=a[i-1];){var s=r.length-1;r.push(a[i-1].execute(r[s])),i++}return jQuery.when.apply(jQuery,r).done(o.resolve),o.promise()}function r(t,n){if(s.WaitMessage&&!s.WaitMessage.ShowProgress!=!0){var o=Math.floor(t/a.length*100),r=s.WaitMessage.ProgressOverrides?s.WaitMessage.ProgressOverrides[n]||n:n;document.getElementById(e.Resources.Provisioning_progressbar_id).innerHTML=String.format(e.Resources.Provisioning_progressbar_markup,o),document.getElementById(e.Resources.Provisioning_progressbar_text_id).innerHTML=r}}function i(r,i){var a=jQuery.Deferred();s=i||{},t(s.WaitMessage),e.Log=new e.Logger(s.Logging);var u=n(r);return o(r,u).then(function(){var t=((new Date).getTime()-c)/1e3;e.Log.Information("Provisioning",String.format(e.Resources.Provisioning_ended,t)),e.Log.SaveToFile().then(function(){l.close(null),a.resolve()})}),a.promise()}var s,a,l,c=null;e.UpdateProgress=r,e.init=i}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));