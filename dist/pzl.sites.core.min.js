var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this.name=e}return e.prototype.ProvisionObjects=function(e,t){},e}();e.ObjectHandlerBase=t}(t=e.Model||(e.Model={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){function n(t,n){var o="LocationBasedMetadataDefaultsReceiver ItemAdded",r=jQuery.Deferred(),i=n.get_eventReceivers();e.Log.Information("Lists Event Receivers","Adding eventreceiver '"+o+"' to list '"+n.get_title()+"'");var s=new SP.EventReceiverDefinitionCreationInformation;return s.set_receiverName(o),s.set_synchronization(1),s.set_sequenceNumber(1e3),s.set_receiverAssembly("Microsoft.Office.DocumentManagement, Version=15.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c"),s.set_receiverClass("Microsoft.Office.DocumentManagement.LocationBasedMetadataDefaultsReceiver"),s.set_eventType(SP.EventReceiverType.itemAdded),i.add(s),n.update(),t.executeQueryAsync(function(){r.resolve()},function(e,t){r.resolve(e,t)}),r.promise()}function o(t,o,r,i){e.Log.Information("Lists Folders","Code execution scope started");var s=jQuery.Deferred(),a=_spPageContextInfo.webServerRelativeUrl+"/"+r,l=t.get_web().getFolderByServerRelativeUrl(a),c="<MetadataDefaults>",u=!1;if(i.forEach(function(t){var n=a+"/"+t.Name;if(e.Log.Information("Lists Folders","Creating folder '"+n+"'"),l.get_folders().add(n),t.DefaultValues){e.Log.Information("Lists Folders","Setting default metadata for folder '"+n+"'");var o=Object.keys(t.DefaultValues).length;o>0&&(c+="<a href='"+a+"/"+t.Name+"'>",Object.keys(t.DefaultValues).forEach(function(e){c+='<DefaultValue FieldName="'+e+'">'+t.DefaultValues[e]+"</DefaultValue>"}),c+="</a>"),u=!0}}),c+="</MetadataDefaults>",u){var f=new SP.FileCreationInformation;f.set_url(a+"/Forms/client_LocationBasedDefaults.html"),f.set_content(new SP.Base64EncodedByteArray),f.set_overwrite(!0);for(var g=0;g<c.length;g++)f.get_content().append(c.charCodeAt(g));l.get_files().add(f),n(t,o).then(function(){t.executeQueryAsync(function(){s.resolve()},function(e,t){s.resolve(e,t)})})}else t.executeQueryAsync(function(){s.resolve()},function(e,t){s.resolve(e,t)});return s.promise()}function r(t,n,o){e.Log.Information("Lists Content Types","Code execution scope started");var r=jQuery.Deferred(),i=t.get_site().get_rootWeb().get_contentTypes(),s=[];return n.forEach(function(n,r){s.push(n.get_contentTypes()),t.load(s[r]),o[r].ContentTypeBindings&&(e.Log.Information("Lists Content Types","Enabled content types for list '"+n.get_title()+"'"),n.set_contentTypesEnabled(!0),n.update())}),t.load(i),t.executeQueryAsync(function(){n.forEach(function(t,n){var r=o[n];if(r.ContentTypeBindings){var a=s[n];r.RemoveExistingContentTypes&&(e.Log.Information("Lists Content Types","Removing existing content types from list '"+t.get_title()+"'"),a.get_data().forEach(function(n){e.Log.Information("Lists Content Types","Removing content type '"+n.get_stringId()+"' from list '"+t.get_title()+"'"),n.deleteObject()})),r.ContentTypeBindings.forEach(function(n){e.Log.Information("Lists Content Types","Adding content type '"+n.ContentTypeId+"' to list '"+t.get_title()+"'"),a.addExistingContentType(i.getById(n.ContentTypeId))}),t.update()}}),t.executeQueryAsync(function(){e.Log.Information("Lists Content Types","Code execution scope ended"),r.resolve()},function(t,n){e.Log.Error("Lists Content Types","Error: "+n.get_message()),e.Log.Information("Lists Content Types","Code execution scope ended"),r.resolve(t,n)})},function(t,n){e.Log.Error("Lists Content Types","Error: "+n.get_message()),e.Log.Information("Lists Content Types","Code execution scope ended"),r.resolve(t,n)}),r.promise()}function i(t,n,o){e.Log.Information("Lists Security","Code execution scope started");var r=jQuery.Deferred();n.forEach(function(n,r){var i=o[r];i.Security&&i.Security.BreakRoleInheritance&&(e.Log.Information("Lists Security","Breaking Role Inheritance for list '"+n.get_title()+"'. CopyRoleAssignments = '"+i.Security.CopyRoleAssignments+"', ClearSubscopes = '"+i.Security.ClearSubscopes+"'"),n.breakRoleInheritance(i.Security.CopyRoleAssignments,i.Security.ClearSubscopes),n.update(),t.load(n.get_roleAssignments()))});var i=t.get_web(),s=i.get_allProperties(),a=i.get_siteGroups(),l=i.get_roleDefinitions();return t.load(s),t.load(l),t.executeQueryAsync(function(){n.forEach(function(n,r){var i=o[r];i.Security&&(i.Security.RoleAssignments.forEach(function(e){var o=null;o="number"==typeof e.RoleDefinition?l.getById(e.RoleDefinition):l.getByName(e.RoleDefinition);var r=SP.RoleDefinitionBindingCollection.newObject(t);r.add(o);var i=null;if(e.Principal.match(/\{[A-Za-z]*\}+/g)){var c=e.Principal.substring(1,e.Principal.length-1),u=s.get_fieldValues()["vti_"+c];i=a.getById(u)}else i=a.getByName(i);n.get_roleAssignments().add(i,r)}),n.update(),e.Log.Information("Lists Security","Role assignments applied for list '"+n.get_title()+"'"))}),t.executeQueryAsync(function(){e.Log.Information("Lists Security","Code execution scope ended"),r.resolve()},function(t,n){e.Log.Error("Lists Security","Error: "+n.get_message()),e.Log.Information("Lists Security","Code execution scope ended"),r.resolve(t,n)})},function(t,n){e.Log.Error("Lists Security","Error: "+n.get_message()),e.Log.Information("Lists Security","Code execution scope ended"),r.resolve(t,n)}),r.promise()}function s(t,n,o){e.Log.Information("Lists Views","Code execution scope started");var r=jQuery.Deferred(),i=[];return n.forEach(function(e,n){i.push(e.get_views()),t.load(i[n])}),t.executeQueryAsync(function(){n.forEach(function(n,r){var s=o[r];s.Views&&(i.push(n.get_views()),t.load(i[r]),s.Views.forEach(function(o){var s=jQuery.grep(i[r].get_data(),function(e){return e.get_title()==o.Title}).length>0;if(s){var a=i[r].getByTitle(o.Title);if(e.Log.Information("Lists Views","Updating existing view '"+o.Title+"' for list '"+n.get_title()+"'"),o.Paged&&a.set_paged(o.Paged),o.Query&&a.set_viewQuery(o.Query),o.RowLimit&&a.set_rowLimit(o.RowLimit),o.ViewFields&&o.ViewFields.length>0){var l=a.get_viewFields();l.removeAll(),o.ViewFields.forEach(function(e){l.add(e)})}o.Scope&&a.set_scope(o.Scope),a.update()}else{e.Log.Information("Lists Views","Adding view '"+o.Title+"' to list '"+n.get_title()+"'");var c=new SP.ViewCreationInformation;o.Title&&c.set_title(o.Title),o.PersonalView&&c.set_personalView(o.PersonalView),o.Paged&&c.set_paged(o.Paged),o.Query&&c.set_query(o.Query),o.RowLimit&&c.set_rowLimit(o.RowLimit),o.SetAsDefaultView&&c.set_setAsDefaultView(o.SetAsDefaultView),o.ViewFields&&c.set_viewFields(o.ViewFields),o.ViewTypeKind&&c.set_viewTypeKind(SP.ViewType.html);var a=n.get_views().add(c);o.Scope&&(a.set_scope(o.Scope),a.update()),n.update()}t.load(n.get_views())}))}),t.executeQueryAsync(function(){e.Log.Information("Lists Views","Code execution scope ended"),r.resolve()},function(t,n){e.Log.Error("Lists Views","Error: "+n.get_message()),e.Log.Information("Lists Views","Code execution scope ended"),r.resolve(t,n)})},function(t,n){e.Log.Error("Lists Views","Error: "+n.get_message()),e.Log.Information("Lists Views","Code execution scope ended"),r.resolve(t,n)}),r.promise()}t.CreateFolders=o,t.ApplyContentTypeBindings=r,t.ApplyListSecurity=i,t.CreateViews=s;var a=function(t){function n(){t.call(this,"Lists")}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=this;e.Log.Information(this.name,"Code execution scope started");var a=jQuery.Deferred(),l=SP.ClientContext.get_current(),c=l.get_web().get_lists(),u=[];return l.load(c),l.executeQueryAsync(function(){return t.forEach(function(t,o){var r=jQuery.grep(c.get_data(),function(e){return e.get_title()==t.Title})[0];if(r)e.Log.Information(n.name,"A list, survey, discussion board, or document library with the specified title '"+t.Title+"' already exists in this Web site at Url '"+t.Url+"'."),u.push(r),l.load(u[o]);else{e.Log.Information(n.name,"Creating list with Title '"+t.Title+"' and Url '"+t.Url+"'.");var i=new SP.ListCreationInformation;t.Description&&i.set_description(t.Description),t.OnQuickLaunch&&i.set_quickLaunchOption(t.OnQuickLaunch?SP.QuickLaunchOptions.on:SP.QuickLaunchOptions.off),t.TemplateType&&i.set_templateType(t.TemplateType),t.Title&&i.set_title(t.Title),t.Url&&i.set_url(t.Url),u.push(c.add(i)),l.load(u[o])}}),l.get_hasPendingRequest()?void l.executeQueryAsync(function(){r(l,u,t).then(function(){s(l,u,t).then(function(){i(l,u,t).then(function(){var r=[];t.forEach(function(e,t){e.Folders&&e.Folders.length>0&&r.push(o(l,u[t],e.Url,e.Folders))}),jQuery.when.apply(jQuery,r).done(function(){l.executeQueryAsync(function(){e.Log.Information(n.name,"Code execution scope ended"),a.resolve()},function(t,o){e.Log.Error(n.name,"Error: "+o.get_message()),e.Log.Information(n.name,"Code execution scope ended"),a.resolve(t,o)})})})})})},function(t,o){e.Log.Error(n.name,"Error: "+o.get_message()),e.Log.Information(n.name,"Code execution scope ended"),a.resolve(t,o)}):(e.Log.Information(n.name,"Code execution scope ended"),a.resolve(),a.promise())},function(t,o){e.Log.Error(n.name,"Error: "+o.get_message()),e.Log.Information(n.name,"Provisioning of objects failed"),a.resolve(t,o)}),a.promise()},n}(e.Model.ObjectHandlerBase);t.Lists=a}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n;!function(e){function t(e){return e.replace("{Site}",_spPageContextInfo.webAbsoluteUrl).replace("{SiteCollection}",_spPageContextInfo.siteAbsoluteUrl).replace("{SiteCollectionRelativeUrl}",_spPageContextInfo.siteServerRelativeUrl).replace("{themegallery}",_spPageContextInfo.siteServerRelativeUrl+"/_catalogs/theme/15")}e.GetUrlWithoutTokens=t}(n||(n={}));var o=function(t){function o(){t.call(this,"ComposedLook")}return __extends(o,t),o.prototype.ProvisionObjects=function(t){var o=this;e.Log.Information(this.name,"Code execution scope started");var r=jQuery.Deferred(),i=SP.ClientContext.get_current(),s=i.get_web(),a=t.ColorPaletteUrl?n.GetUrlWithoutTokens(t.ColorPaletteUrl):"",l=t.FontSchemeUrl?n.GetUrlWithoutTokens(t.FontSchemeUrl):"",c=t.BackgroundImageUrl?n.GetUrlWithoutTokens(t.BackgroundImageUrl):null;return s.applyTheme(a,l,c,!0),s.update(),i.executeQueryAsync(function(){e.Log.Information(o.name,"Code execution scope ended"),r.resolve()},function(t,n){e.Log.Information(o.name,"Code execution scope ended"),e.Log.Information(o.name,n.get_message()),r.resolve(t,n)}),r.promise()},o}(e.Model.ObjectHandlerBase);t.ComposedLook=o}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){function n(t,n,o){var r=jQuery.Deferred();e.Log.Information("Files","Creating file with Url '"+t+"'");var i=SP.ClientContext.get_current(),s=i.get_web(),a=c.GetFileUrlWithoutTokens(n),l=c.GetFolderFromFilePath(t),u=c.GetFilenameFromFilePath(t),f=_spPageContextInfo.webServerRelativeUrl+"/"+l,g=s.getFolderByServerRelativeUrl(f);return jQuery.get(a,function(n){var s=new SP.FileCreationInformation;s.set_overwrite(o),s.set_url(u),s.set_content(new SP.Base64EncodedByteArray);for(var a=0;a<n.length;a++)s.get_content().append(n.charCodeAt(a));i.load(g.get_files().add(s)),i.executeQueryAsync(function(){r.resolve()},function(n,o){e.Log.Information("Files","Failed to create file with Url '"+t+"'"),e.Log.Error("Files",""+o.get_message()),r.resolve(n,o)})}),r.promise()}function o(e,t,n){var o=jQuery.Deferred();if(!n)return o.resolve(),o.promise();var r=t.get_webParts();return e.load(r),e.executeQueryAsync(function(){r.get_data().forEach(function(e){e.deleteWebPart()}),e.load(r),e.executeQueryAsync(function(){o.resolve()},function(){o.resolve()})},function(){o.resolve()}),o.promise()}function r(e){var t=jQuery.Deferred(),n=[];return e.forEach(function(t,o){t.Contents.FileUrl&&n.push(function(){var n=jQuery.Deferred(),r=c.GetFileUrlWithoutTokens(t.Contents.FileUrl);return jQuery.get(r,function(t){e[o].Contents.Xml=t,n.resolve()}).fail(function(e,t){n.resolve(e,t)}),n.promise()}())}),jQuery.when.apply(jQuery,n).done(function(){t.resolve(e)}),t.promise()}function i(t,n,i,s){var a=jQuery.Deferred(),l=SP.ClientContext.get_current(),u=l.get_web(),f=c.LastItemInArray(n.split("/")),g=_spPageContextInfo.webServerRelativeUrl+"/"+t,d=u.getFileByServerRelativeUrl(g);return l.load(d),l.executeQueryAsync(function(){var n=d.getLimitedWebPartManager(SP.WebParts.PersonalizationScope.shared);o(l,n,s).then(function(){r(i).then(function(o){o.forEach(function(o){if(o.Contents.Xml){e.Log.Information("Files Web Parts","Adding web part '"+o.Title+"' to zone '"+o.Zone+"' for file with URL '"+t+"'");var r=n.importWebPart(c.GetWebPartXmlWithoutTokens(o.Contents.Xml)),i=r.get_webPart();n.addWebPart(i,o.Zone,o.Order)}}),l.executeQueryAsync(function(){a.resolve()},function(t,n){e.Log.Information("Files Web Parts","Provisioning of objects failed for file with Url '"+f+"'"),e.Log.Error("Files Web Parts",""+n.get_message()),a.resolve(t,n)})})})},function(t,n){e.Log.Information("Files Web Parts","Provisioning of objects failed for file with Url '"+f+"'"),e.Log.Error("Files Web Parts",""+n.get_message()),a.resolve(t,n)}),a.promise()}function s(t,n){var o=jQuery.Deferred(),r=SP.ClientContext.get_current(),i=r.get_web(),s=_spPageContextInfo.webServerRelativeUrl+"/"+t,a=i.getFileByServerRelativeUrl(s),l=a.get_listItemAllFields();e.Log.Information("Files Properties","Setting properties for file with URL '"+t+"'");for(var c in n)e.Log.Information("Files Properties","Setting property '"+c+"' = '"+n[c]+"' for file with URL '"+t+"'"),l.set_item(c,n[c]);return l.update(),r.executeQueryAsync(function(){o.resolve()},function(n,r){e.Log.Information("Files Properties","Provisioning of objects failed for file with Url '"+t+"'"),e.Log.Error("Files Properties",""+r.get_message()),o.resolve(n,r)}),o.promise()}function a(e,t){for(var n=_spPageContextInfo.webServerRelativeUrl+"/"+t,o=e.getEnumerator();o.moveNext();){var r=o.get_current();if(r.get_serverRelativeUrl().toString().toLowerCase()===n.toLowerCase())return r}return null}function l(t){e.Log.Information("Hidden Views","Code execution scope started");var n=jQuery.Deferred(),o=SP.ClientContext.get_current(),r=o.get_web(),i={},s=[],l=[];return t.forEach(function(e){e.Views&&e.Views.forEach(function(t){i[t.List]=i[t.List]||[],i[t.List].push(jQuery.extend(t,{Url:e.Dest}))})}),Object.keys(i).forEach(function(e,t){s.push(r.get_lists().getByTitle(e)),l.push(r.get_lists().getByTitle(e).get_views()),o.load(s[t]),o.load(l[t])}),o.executeQueryAsync(function(){Object.keys(i).forEach(function(t,n){e.Log.Information("Hidden Views","Modifying list views for list '"+t+"'");var r=i[t],c=s[n],u=l[n];r.forEach(function(n){var o=a(u,n.Url);if(null!=o){if(e.Log.Information("Hidden Views","Modifying list view with Url '"+n.Url+"' for list '"+t+"'"),n.Paged&&o.set_paged(n.Paged),n.Query&&o.set_viewQuery(n.Query),n.RowLimit&&o.set_rowLimit(n.RowLimit),n.ViewFields&&n.ViewFields.length>0){var r=o.get_viewFields();r.removeAll(),n.ViewFields.forEach(function(e){r.add(e)})}o.update()}}),o.load(u),c.update()}),o.executeQueryAsync(function(){e.Log.Information("Hidden Views","Code execution scope ended"),n.resolve()},function(t,o){e.Log.Error("Hidden Views","Error: "+o.get_message()),e.Log.Information("Hidden Views","Code execution scope ended"),n.resolve(t,o)})},function(t,o){e.Log.Error("Hidden Views","Error: "+o.get_message()),e.Log.Information("Hidden Views","Code execution scope ended"),n.resolve(t,o)}),n.promise()}var c;!function(e){function t(e){return e.replace(/{resources}/g,_spPageContextInfo.siteServerRelativeUrl+"/resources").replace(/{webpartgallery}/g,_spPageContextInfo.siteServerRelativeUrl+"/_catalogs/wp")}function n(e){return e.replace(/{site}/g,_spPageContextInfo.webServerRelativeUrl).replace(/{sitecollection}/g,_spPageContextInfo.siteServerRelativeUrl)}function o(e){var t=e.split("/");return t.splice(0,t.length-1).join("/")}function r(e){var t=e.split("/");return t[t.length-1]}function i(e){return e[e.length-1]}e.GetFileUrlWithoutTokens=t,e.GetWebPartXmlWithoutTokens=n,e.GetFolderFromFilePath=o,e.GetFilenameFromFilePath=r,e.LastItemInArray=i}(c||(c={}));var u=function(t){function o(){t.call(this,"Files")}return __extends(o,t),o.prototype.ProvisionObjects=function(t){var o=this;e.Log.Information(this.name,"Code execution scope started");var r=jQuery.Deferred(),a=(SP.ClientContext.get_current(),[]);return t.forEach(function(e){n(e.Dest,e.Src,e.Overwrite)}),jQuery.when.apply(jQuery,a).done(function(){var n=[];t.forEach(function(e){e.WebParts&&e.WebParts.length>0&&n.push(i(e.Dest,e.Src,e.WebParts,e.RemoveExistingWebParts))}),jQuery.when.apply(jQuery,n).done(function(){var n=[];t.forEach(function(e){e.Properties&&Object.keys(e.Properties).length>0&&n.push(s(e.Dest,e.Properties))}),jQuery.when.apply(jQuery,n).done(function(){l(t).then(function(){e.Log.Information(o.name,"Code execution scope ended"),r.resolve()})})})}),r.promise()},o}(e.Model.ObjectHandlerBase);t.Files=u}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){function n(t){var n=jQuery.Deferred();e.Log.Information("Pages","Creating file with Url '"+t+"'");var r=SP.ClientContext.get_current(),i=r.get_web(),s=_spPageContextInfo.webServerRelativeUrl+"/"+t,a=_spPageContextInfo.webServerRelativeUrl+"/"+o.GetFolderFromFilePath(t),l=i.getFolderByServerRelativeUrl(a);return r.load(l.get_files().addTemplateFile(s,SP.TemplateFileType.wikiPage)),r.executeQueryAsync(function(){n.resolve()},function(o,r){e.Log.Information("Pages","Failed to create file with Url '"+t+"'"),e.Log.Error("Pages",""+r.get_message()),n.resolve(o,r)}),n.promise()}var o;!function(e){function t(e){return e.replace(/{site}/g,_spPageContextInfo.webServerRelativeUrl).replace(/{sitecollection}/g,_spPageContextInfo.siteServerRelativeUrl)}function n(e){var t=e.split("/");return t.splice(0,t.length-1)}e.GetWebPartXmlWithoutTokens=t,e.GetFolderFromFilePath=n}(o||(o={})),t.AddWikiPageByUrl=n;var r=function(t){function o(){t.call(this,"Pages")}return __extends(o,t),o.prototype.ProvisionObjects=function(t){var o=this;e.Log.Information(this.name,"Code execution scope started");var r=jQuery.Deferred(),i=(SP.ClientContext.get_current(),[]);return t.forEach(function(e){n(e.Url)}),jQuery.when.apply(jQuery,i).done(function(){e.Log.Information(o.name,"Code execution scope ended"),r.resolve()}),r.promise()},o}(e.Model.ObjectHandlerBase);t.Pages=r}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this,"CustomActions")}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=this,o=jQuery.Deferred();e.Log.Information(this.name,"Starting provisioning of objects");var r=SP.ClientContext.get_current(),i=r.get_web().get_userCustomActions();return r.load(i),r.executeQueryAsync(function(){return t.forEach(function(t){var o=jQuery.grep(i.get_data(),function(e){return e.get_title()==t.Title}).length>0;if(o)e.Log.Information(n.name,"A custom action with Title '"+t.Title+"' already exists in this Web site at Url '"+t.Url+"'.");else{e.Log.Information(n.name,"Creating custom action with Title '"+t.Title+"'");var r=i.add();t.Description&&r.set_description(t.Description),t.CommandUIExtension&&r.set_commandUIExtension(t.CommandUIExtension),t.Group&&r.set_group(t.Group),t.Title&&r.set_title(t.Title),t.Url&&r.set_url(t.Url),t.ScriptBlock&&r.set_scriptBlock(t.ScriptBlock),t.ScriptSrc&&r.set_scriptSrc(t.ScriptSrc),t.Location&&r.set_location(t.Location),t.ImageUrl&&r.set_imageUrl(t.ImageUrl),t.Name&&r.set_name(t.Name),t.RegistrationId&&r.set_registrationId(t.RegistrationId),t.RegistrationType&&r.set_registrationType(t.RegistrationType),t.Rights&&r.set_rights(t.Rights),t.Sequence&&r.set_sequence(t.Sequence),r.update()}}),r.get_hasPendingRequest()?void r.executeQueryAsync(function(){e.Log.Information(n.name,"Provisioning of objects ended"),o.resolve()},function(t,r){e.Log.Information(n.name,"Provisioning of objects failed"),e.Log.Error(n.name,""+r.get_message()),o.resolve(t,r)}):(e.Log.Information(n.name,"Provisioning of objects ended"),o.resolve(),o.promise())},function(t,r){e.Log.Information(n.name,"Provisioning of objects failed"),e.Log.Error(n.name,""+r.get_message()),o.resolve(t,r)}),o.promise()},n}(e.Model.ObjectHandlerBase);t.CustomActions=n}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n;!function(e){function t(e){return e.replace("{Site}",_spPageContextInfo.webAbsoluteUrl).replace("{SiteRelativeUrl}",_spPageContextInfo.webServerRelativeUrl).replace("{SiteUrl}",_spPageContextInfo.webAbsoluteUrl).replace("{SiteUrlEncoded}",encodeURIComponent(_spPageContextInfo.webAbsoluteUrl)).replace("{SiteCollection}",_spPageContextInfo.siteAbsoluteUrl).replace("{SiteCollectionRelativeUrl}",_spPageContextInfo.siteServerRelativeUrl).replace("{SiteCollectionEncoded}",encodeURIComponent(_spPageContextInfo.siteAbsoluteUrl)).replace("{WebApp}",window.location.protocol+"//"+window.location.host)}function n(e,t){var n=jQuery.grep(e,function(e){return e.get_title()===t});return n[0]||null}e.GetUrlWithoutTokens=t,e.GetNodeFromQuickLaunchByTitle=n}(n||(n={}));var o=function(t){function o(){t.call(this,"LocalNavigation")}return __extends(o,t),o.prototype.ProvisionObjects=function(t){var o=this,r=jQuery.Deferred(),i=SP.ClientContext.get_current(),s=i.get_web();e.Log.Information(this.name,"Starting provisioning of objects");var a=s.get_navigation(),l=a.get_quickLaunch();return i.load(l),i.executeQueryAsync(function(){e.Log.Information(o.name,"Removing existing navigation nodes");for(var s=[],a=l.get_count()-1;a>=0;){var c=l.itemAt(a);s.push(c),c.deleteObject(),a--}i.executeQueryAsync(function(){t.forEach(function(t){e.Log.Information(o.name,"Adding navigation node with Url '"+t.Url+"' and Title '"+t.Title+"'");var r=n.GetNodeFromQuickLaunchByTitle(s,t.Title),i=new SP.NavigationNodeCreationInformation;i.set_title(t.Title),i.set_url(r?r.get_url():n.GetUrlWithoutTokens(t.Url)),i.set_asLastNode(!0),l.add(i)}),i.executeQueryAsync(function(){e.Log.Information(o.name,"Provisioning of objects ended"),r.resolve()},function(t,n){e.Log.Information(o.name,"Provisioning of objects failed"),e.Log.Error(o.name,""+n.get_message()),r.resolve(t,n)})})},function(t,n){e.Log.Information(o.name,"Provisioning of objects failed"),e.Log.Error(o.name,""+n.get_message()),r.resolve(t,n)}),r.promise()},o}(e.Model.ObjectHandlerBase);t.LocalNavigation=o}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this,"PropertyBagEntries")}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=this;e.Log.Information(this.name,"Starting provisioning of objects");var o=jQuery.Deferred(),r=SP.ClientContext.get_current(),i=r.get_web(),s=i.get_allProperties();for(var a in t)e.Log.Information(this.name,"Setting property '"+a+"' = '"+t[a]+"' on web"),s.set_item(a,t[a]);return i.update(),r.executeQueryAsync(function(){e.Log.Information(n.name,"Provisioning of objects ended"),o.resolve()},function(e,t){o.resolve(e,t)}),o.promise()},n}(e.Model.ObjectHandlerBase);t.PropertyBagEntries=n}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this,"WebSettings")}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=jQuery.Deferred(),o=SP.ClientContext.get_current(),r=o.get_web();return t.WelcomePage&&(e.Log.Information(this.name,"Setting WelcomePage to '"+t.WelcomePage+"'"),r.get_rootFolder().set_welcomePage(t.WelcomePage),r.get_rootFolder().update()),r.update(),o.load(r),o.executeQueryAsync(function(){n.resolve()},function(e,t){n.resolve(e,t)}),n.promise()},n}(e.Model.ObjectHandlerBase);t.WebSettings=n}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this.array=[],this.loggingOptions=e}return e.prototype.loggerEnabled=function(){return console&&console.log},e.prototype.Information=function(e,t){if(this.loggingOptions){var n=new Date+" || Information || "+e+" || "+t;this.loggerEnabled&&this.loggingOptions.On&&console.log(n),this.array.push(n)}},e.prototype.Error=function(e,t){if(this.loggingOptions){var n=new Date+" || Error || "+e+" || "+t;this.loggerEnabled&&this.loggingOptions.On&&console.log(n),this.array.push(n)}},e.prototype.SaveToFile=function(){var e=jQuery.Deferred();if(!this.loggingOptions||!this.loggingOptions.LoggingFolder)return e.resolve(),e.promise();var t=SP.ClientContext.get_current(),n=t.get_site().get_rootWeb(),o=(new Date).getTime()+".txt",r=new SP.FileCreationInformation;r.set_url(o),r.set_content(new SP.Base64EncodedByteArray);for(var i=this.array.join("\n"),s=0;s<i.length;s++)r.get_content().append(i.charCodeAt(s));return t.load(n.getFolderByServerRelativeUrl(this.loggingOptions.LoggingFolder).get_files().add(r)),t.executeQueryAsync(function(){e.resolve()},function(t,n){e.resolve(t,n)}),e.promise()},e}();e.Logger=t}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e,t,n,o,r){this.name=e,this.index=t,this.objects=n,this.parameters=o,this.callback=r}return e.prototype.execute=function(e){var t=this;if(!e)return this.callback(this.objects,this.parameters);var n=jQuery.Deferred();return e.done(function(){return t.callback(t.objects,t.parameters).done(function(){n.resolve()})}),n.promise()},e}();e.TemplateQueueItem=t}(t=e.Model||(e.Model={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){function t(e,t,n,o){i=SP.UI.ModalDialog.showWaitScreenWithNoClose(e,t,n,o)}function n(e){return Object.keys(e)}function o(t,n){var o=jQuery.Deferred();s=(new Date).getTime(),e.Log.Information("Provisioning","Starting at URL '"+_spPageContextInfo.webServerRelativeUrl+"'");var r=[];n.forEach(function(n,o){e.ObjectHandlers[n]&&r.push(new e.Model.TemplateQueueItem(n,o,t[n],t.Parameters,(new e.ObjectHandlers[n]).ProvisionObjects))});var i=[];i.push(jQuery.Deferred()),i[0].resolve(),i[0].promise();for(var a=1;void 0!=r[a-1];){var l=i.length-1;i.push(r[a-1].execute(i[l])),a++}return jQuery.when.apply(jQuery,i).done(function(){o.resolve()}),o.promise()}function r(r,a){var l=jQuery.Deferred();t("Applying template","This might take a moment..",130,600),e.Log=new e.Logger(a);var c=n(r);return o(r,c).then(function(){var t=((new Date).getTime()-s)/1e3;e.Log.Information("Provisioning","All done in "+t+" seconds"),e.Log.SaveToFile().then(function(){i.close(null),l.resolve()})}),l.promise()}var i,s=null;e.init=r}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));